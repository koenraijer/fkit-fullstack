import{s as z,x as O,e as S,i as k,d as h,f as v,a as A,g as y,h as T,c as E,j as b,D as U,y as _,R as W,M as I,N as B,O as F,l as C,m as w,C as L,n as D}from"../chunks/scheduler.e4fe527f.js";import{S as Z,i as G,b as H,d as J,m as K,a as Q,t as X,e as $}from"../chunks/index.bdfbb633.js";import{A as x}from"../chunks/AuthCheck.a70a9fb2.js";import{a as ee,u as te,g as R,c as N,o as se,W as le}from"../chunks/firebase.bfe19b46.js";function ne(a){let e,t,l,s,n,i,d,u,g,m=a[1]&&M(a),f=!a[3]&&a[5]&&V(),p=a[3]&&!a[2]&&!a[1]&&Y(a),o=a[2]&&j(a);return{c(){e=v("form"),t=v("input"),l=A(),s=v("div"),m&&m.c(),n=A(),f&&f.c(),i=A(),p&&p.c(),d=A(),o&&o.c(),this.h()},l(r){e=y(r,"FORM",{class:!0});var c=T(e);t=y(c,"INPUT",{type:!0,placeholder:!0,class:!0}),l=E(c),s=y(c,"DIV",{class:!0});var P=T(s);m&&m.l(P),n=E(P),f&&f.l(P),i=E(P),p&&p.l(P),d=E(P),o&&o.l(P),P.forEach(h),c.forEach(h),this.h()},h(){b(t,"type","text"),b(t,"placeholder","Username"),b(t,"class","input w-full"),U(t,"input-error",!a[3]&&a[5]),U(t,"input-warning",a[4]),U(t,"input-success",a[2]&&a[3]&&!a[1]),b(s,"class","my-4 min-h-16 px-8 w-full"),b(e,"class","w-2/5")},m(r,c){k(r,e,c),_(e,t),W(t,a[0]),_(e,l),_(e,s),m&&m.m(s,null),_(s,n),f&&f.m(s,null),_(s,i),p&&p.m(s,null),_(s,d),o&&o.m(s,null),u||(g=[I(t,"input",a[9]),I(t,"input",a[7]),I(e,"submit",B(a[8]))],u=!0)},p(r,c){c&1&&t.value!==r[0]&&W(t,r[0]),c&40&&U(t,"input-error",!r[3]&&r[5]),c&16&&U(t,"input-warning",r[4]),c&14&&U(t,"input-success",r[2]&&r[3]&&!r[1]),r[1]?m?m.p(r,c):(m=M(r),m.c(),m.m(s,n)):m&&(m.d(1),m=null),!r[3]&&r[5]?f||(f=V(),f.c(),f.m(s,i)):f&&(f.d(1),f=null),r[3]&&!r[2]&&!r[1]?p?p.p(r,c):(p=Y(r),p.c(),p.m(s,d)):p&&(p.d(1),p=null),r[2]?o?o.p(r,c):(o=j(r),o.c(),o.m(s,null)):o&&(o.d(1),o=null)},d(r){r&&h(e),m&&m.d(),f&&f.d(),p&&p.d(),o&&o.d(),u=!1,F(g)}}}function ae(a){let e,t,l,s,n=a[6].username+"",i,d,u,g="(Usernames cannot be changed)",m,f,p="Upload Profile Image";return{c(){e=v("p"),t=C("Your username is "),l=v("span"),s=C("@"),i=C(n),d=A(),u=v("p"),u.textContent=g,m=A(),f=v("a"),f.textContent=p,this.h()},l(o){e=y(o,"P",{class:!0});var r=T(e);t=w(r,"Your username is "),l=y(r,"SPAN",{class:!0});var c=T(l);s=w(c,"@"),i=w(c,n),c.forEach(h),r.forEach(h),d=E(o),u=y(o,"P",{class:!0,["data-svelte-h"]:!0}),L(u)!=="svelte-9l80or"&&(u.textContent=g),m=E(o),f=y(o,"A",{class:!0,href:!0,["data-svelte-h"]:!0}),L(f)!=="svelte-3ry8kx"&&(f.textContent=p),this.h()},h(){b(l,"class","text-success font-bold"),b(e,"class","text-lg"),b(u,"class","text-sm"),b(f,"class","btn btn-primary"),b(f,"href","/signup/photo")},m(o,r){k(o,e,r),_(e,t),_(e,l),_(l,s),_(l,i),k(o,d,r),k(o,u,r),k(o,m,r),k(o,f,r)},p(o,r){r&64&&n!==(n=o[6].username+"")&&D(i,n)},d(o){o&&(h(e),h(d),h(u),h(m),h(f))}}}function M(a){let e,t,l,s;return{c(){e=v("p"),t=C("Checking availability of @"),l=C(a[0]),s=C("..."),this.h()},l(n){e=y(n,"P",{class:!0});var i=T(e);t=w(i,"Checking availability of @"),l=w(i,a[0]),s=w(i,"..."),i.forEach(h),this.h()},h(){b(e,"class","text-secondary")},m(n,i){k(n,e,i),_(e,t),_(e,l),_(e,s)},p(n,i){i&1&&D(l,n[0])},d(n){n&&h(e)}}}function V(a){let e,t="must be 3-16 characters long, alphanumeric only";return{c(){e=v("p"),e.textContent=t,this.h()},l(l){e=y(l,"P",{class:!0,["data-svelte-h"]:!0}),L(e)!=="svelte-1wurl8l"&&(e.textContent=t),this.h()},h(){b(e,"class","text-error text-sm")},m(l,s){k(l,e,s)},d(l){l&&h(e)}}}function Y(a){let e,t,l,s;return{c(){e=v("p"),t=C("@"),l=C(a[0]),s=C(" is not available"),this.h()},l(n){e=y(n,"P",{class:!0});var i=T(e);t=w(i,"@"),l=w(i,a[0]),s=w(i," is not available"),i.forEach(h),this.h()},h(){b(e,"class","text-warning text-sm")},m(n,i){k(n,e,i),_(e,t),_(e,l),_(e,s)},p(n,i){i&1&&D(l,n[0])},d(n){n&&h(e)}}}function j(a){let e,t,l;return{c(){e=v("button"),t=C("Confirm username @"),l=C(a[0]),this.h()},l(s){e=y(s,"BUTTON",{class:!0});var n=T(e);t=w(n,"Confirm username @"),l=w(n,a[0]),n.forEach(h),this.h()},h(){b(e,"class","btn btn-success")},m(s,n){k(s,e,n),_(e,t),_(e,l)},p(s,n){n&1&&D(l,s[0])},d(s){s&&h(e)}}}function ie(a){let e;function t(n,i){var d;return(d=n[6])!=null&&d.username?ae:ne}let l=t(a),s=l(a);return{c(){s.c(),e=S()},l(n){s.l(n),e=S()},m(n,i){s.m(n,i),k(n,e,i)},p(n,i){l===(l=t(n))&&s?s.p(n,i):(s.d(1),s=l(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&h(e),s.d(n)}}}function re(a){let e,t;return e=new x({props:{$$slots:{default:[ie]},$$scope:{ctx:a}}}),{c(){H(e.$$.fragment)},l(l){J(e.$$.fragment,l)},m(l,s){K(e,l,s),t=!0},p(l,[s]){const n={};s&4223&&(n.$$scope={dirty:s,ctx:l}),e.$set(n)},i(l){t||(Q(e.$$.fragment,l),t=!0)},o(l){X(e.$$.fragment,l),t=!1},d(l){$(e,l)}}}const oe=/^(?=[a-zA-Z0-9._]{3,16}$)(?!.*[_.]{2})[^_.].*[^_.]$/;function ue(a,e,t){let l,s,n,i,d;O(a,ee,c=>t(11,i=c)),O(a,te,c=>t(6,d=c));let u="",g=!1,m=!1,f;function p(){if(t(2,m=!1),clearTimeout(f),!l){t(1,g=!1);return}t(1,g=!0),f=setTimeout(async()=>{console.log("checking availability of",u);const c=R(N,"usernames",u),P=await se(c).then(q=>q.exists());t(2,m=!P),t(1,g=!1)},500)}async function o(){console.log("confirming username",u);const c=le(N);c.set(R(N,"usernames",u),{uid:i==null?void 0:i.uid}),c.set(R(N,"users",i.uid),{username:u,photoURL:(i==null?void 0:i.photoURL)??null,published:!0,bio:"I am the Walrus",links:[{title:"Test Link",url:"https://kung.foo",icon:"custom"}]}),await c.commit(),t(0,u=""),t(2,m=!1)}function r(){u=this.value,t(0,u)}return a.$$.update=()=>{a.$$.dirty&1&&t(3,l=(u==null?void 0:u.length)>2&&u.length<16&&oe.test(u)),a.$$.dirty&1&&t(5,s=u.length>0),a.$$.dirty&14&&t(4,n=l&&!m&&!g)},[u,g,m,l,n,s,d,p,o,r]}class he extends Z{constructor(e){super(),G(this,e,ue,re,z,{})}}export{he as component};
